<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<div class= "row">
   <button style="float:left;" class="btn waves-effect waves-light btn__back" onclick="history.back()"><i class="fas fa-arrow-alt-circle-left"></i>  &nbspGo Back
   </button>

   <button style="float:right; margin: 10px 10px; " class="btn waves-effect waves-light center-align" ng-click="logout()">    LOG OUT   
       <i class="fas fa-sign-out-alt"></i>
    </button>
</div>

<form>
    <div id="grad" class="container student-card card">
        <div style="font-size:20px;color:blue; margin: 20px">**Please check for formats of information given below the respective fields before updating changes</div>
    
        <div class=" card-content row">

        <div class="col s4">


            <div class="student-name">
                <input type="text" pattern="[a-zA-Z ]*$" class="validate editField name" maxlength="35" ng-pattern-restrict title="Please enter alphanets only"  ng-disabled="editName" style="font-size:25px;" ng-required="true" id="name"><br>
            </div>
            <!-- <span ng-show="teacher.name==undefined" class="wrong"><i class="fa fa-times" aria-hidden="true"></i> Teacher name should contain only alphabets and spaces</span> -->
                    
            <a href="" ng-click="editName==false ? editName=true:editName=false" style="text-transform: uppercase">
                <span ng-show="editName">Edit Field</span><span ng-show="!editName">Done</span> 
                <i class="fa fa-pencil-square-o" aria-hidden="true" style="font-size:22px"></i>
            </a>

        </div>
        <div class="col s4">
            <center>
                <img id="stud-img" class="student-main-image" src="" style="height: 200px; width: 200px;">
                <br><br>

                <div style="margin-bottom: 0px !important;" class="row">

                   <form name="form" action="/tupload_photo" method="POST" onSubmit="alert('Image uploaded')" class="uploadImage" enctype="multipart/form-data">
                        <input class="file-input" id="file" type='file' ng-model="photo" name="photo" value="file" >
                        <br><br>
                        <button name="submit" class="waves-effect waves-light  btn" type="submit">Upload File</button>
                    </form>

                </div>
            </center>

        </div>
        <!-- <div class="col s4">
            <button class="logout btn waves-effect waves-light right" ng-click="logout()">LOG OUT
               <i class="fas fa-sign-out-alt"></i>
            </button>
        </div> -->
    </div>

    <div class="card-action">
        <div class="row">

            <div class="col s4">
                <div class="small-title">USS</div>
                
                <div id="uss" class="small-content school">
                    <!-- {{teacher.school | uppercase}} -->
                    <br>
                </div> 

            </div>

            <div class="col s4">
                <div class="small-title">ROOM NO</div>

                <div class="small-content stream">
                    <span style="color:blue; display: block;font-size:12px;margin:10px;">Enter room in the pattern: Name of block followed by '-' then 3 digit room number. Ex:- E-412</span>
                    <input type="text" id="room" ng-required="true" ng-focus="fieldTouch[0]=true" ng-disabled="editRoom" maxlength="5" pattern="[ABCDE]-[1-6][\d]{2}" title="Pattern should be {Block-Room_no}. Ex:- E-109. Available blocks : A,B,C,D,E"><br>
                    <!-- <span class="rght" ng-show="teacher.room_no!=undefined && teacher.room_no.length!=0 && fieldTouch[0]"><i class="fa fa-check" aria-hidden="true"></i> Room Number entered correctly</span> -->
                    <!-- <span ng-show="teacher.room_no==undefined || teacher.room_no.length==0 && fieldTouch[0]" class="wrong"><i class="fa fa-times" aria-hidden="true"></i> Wrong room entered. Blocks available are A/B/C/D/E and 6 floors are present</span> -->
                    <a href="" ng-click="editRoom==false ? editRoom=true:editRoom=false">
                        <span ng-show="editRoom">Edit Field</span><span ng-show="!editRoom">Done</span>    
                        <i class="fa fa-pencil-square-o" aria-hidden="true" style="font-size:22px"></i>
                    </a>
                </div>

            </div>
            <div class="col s4">
                <div class="small-title">DATE OF JOINING</div>

                <div class="small-content date">
                    <span style="color:blue; display: block;font-size:12px;margin:10px;">Please select date from the dropdown button that appears on extreme right of this field. Limits of date : 01-01-1999 till today</span>
                    <input type="date" name="date" id="dateofj" ng-focus="fieldTouch[1]=true" ng-required="true" min="1999-01-01" max="2019-01-01"  ng-disabled="editDoj" title="Please select date from the dropdown button that appears on extreme right of this field"><br>
                    <!-- <span class="rght right" ng-show="teacher.date_of_joining!=undefined && fieldTouch[1] && teacher.date_of_joining.length!=0 && teacher.date_of_joining!='0000-00-00'"><i class="fa fa-check" aria-hidden="true"></i> Date of joining entered correctly</span>
                    <span ng-show="teacher.date_of_joining==undefined || teacher.date_of_joining.length==0 || teacher.date_of_joining=='0000-00-00' && fieldTouch[1]" class="right wrong"><i class="fa fa-times" aria-hidden="true"></i> Wrong format of Date of Joining. Select date from dropdown menu.</span> -->
                    <a href="" ng-click="editDoj==false ? editDoj=true:editDoj=false">
                        <span ng-show="editDoj">Edit Field</span><span ng-show="!editDoj">Done</span>
                        <i class="fa fa-pencil-square-o" aria-hidden="true" style="font-size:22px"></i>
                    </a>

                </div>

            </div>
        </div>
    </div>

    <div class="card-action">
        <div class="row">
            <div class="col s12">
                <div class="small-title">EMAIL ID</div>
                <div class="input-field col s6">
                    <span  style="color:blue; display: block;font-size:12px;margin:10px;">Enter only a valid email id</span>
                    <input placeholder="Email-Id" id="email" name="email" ng-focus="fieldTouch[2]=true" nameid="last_name" type="email" ng-required="true" class="validate editField email-id" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" title="Enter valid email Id" ng-disabled="editEmail">
                    <!-- <span class="rght right" ng-show="teacher.email!=undefined && teacher.email.length!=0 && fieldTouch[2]"><i class="fa fa-check" aria-hidden="true"></i> Email id format entered correctly</span> -->
                    <!-- <span ng-show="teacher.email==undefined || teacher.email.length==0 && fieldTouch[2]" class="wrong right"><i class="fa fa-times" aria-hidden="true"></i> Wrong email-id entered. Format is abc123@xyz.com</span> -->
                    
                    <a href="" ng-click="editEmail==false ? editEmail=true:editEmail=false">
                        <span ng-show="editEmail">Edit Field</span><span ng-show="!editEmail">Done</span>
                        <i class="fa fa-pencil-square-o" aria-hidden="true" style="font-size:22px"></i>
                    </a>
                    
                </div>

                <div class="small-title">PHONE NUMBER</div>
                <div class="input-field col s6">
                    <span  style="color:blue; display: block;font-size:12px;margin:10px;">Enter 10 digit Indian mobile number starting with 7/8/9</span>
                    <input placeholder="phone number" id="phone" ng-focus="fieldTouch[3]=true" type="tel" ng-required="true" class="validate editField phone" pattern="[789][0-9]{9}" maxlength="10" title="Enter 10 digit mobile number" ng-disabled="editPhone" >
                    <!-- <span class="rght right" ng-show="teacher.phone!=undefined && teacher.phone.length!=0 && teacher.phone!=0 && fieldTouch[3]"><i class="fa fa-check" aria-hidden="true"></i> Mobile number entered correctly</span>
                    <span ng-show="teacher.phone==undefined || teacher.phone.length==0 || teacher.phone==0 && fieldTouch[3]" class="wrong right"><i class="fa fa-times" aria-hidden="true"></i> Wrong format of Mobile number entered</span> -->
                    
                    <a href="" ng-click="editPhone==false ? editPhone=true:editPhone=false">                        
                        <span ng-show="editPhone">Edit Field</span><span ng-show="!editPhone">Done</span>
                        <i class="fa fa-pencil-square-o" aria-hidden="true" style="font-size:22px"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="card-action">
           Edited fields can be saved by pressing &nbsp&nbsp&nbsp 
            <input  type="submit" class="btn waves-effect waves-light" ng-click="updateTeacherInfo()" value="update information" type="submit"/ ng-disabled="!editName || !editRoom || !editDoj || !editPhone || !editEmail">
        </div>
    
</div>
</form>

<div class="row">
    <div class="col m2">
        <select ng-model="year" ng-options="option for option in ['August 2016 - May 2017','August 2017 - May 2018','August 2018 - May 2019', 'August 2019 - May 2020','August 2020 - May 2021', 'August 2021 - May 2022']" ng-change="yearChange()">
            <option value="" disabled selected>Choose Academic Year</option>
        </select>
    </div>
    <div class="col s2">
         <select ng-model="selectedCourse" ng-options="option for option in course" ng-change="streamList();subjectLists();semesterList()">
            <option value=""  selected>All Course</option>
        </select>
    </div>
    <div class="col s2">
        <select ng-model="selectedStream" ng-options="option for option in stream" ng-change="subjectLists();semesterList()">
            <option value=""  selected>All Stream</option>
        </select>
    </div>
    <div class="col s2">
        <select ng-model="selectedSem" ng-options="option for option in semester" ng-change="subjectLists()">
            <option value=""  selected>All Semester</option>
        </select>
    </div>
    <div class="col s4">
        <select ng-model="selectedSubject" ng-options="option for option in subjects" ng-change="hanu()">
            <option value="" selected>All Subject</option>
        </select>
    </div>
</div>
<div class="row">
    <div class="col s1">

    </div>
</div>

<div class="center" ng-hide="searching">
    <a class="waves-effect white black-text btn" ng-click="search()" style="margin-right:20px">SEARCH</a>
    <a class="waves-effect white black-text btn" ng-click="print()" ng-disabled="disabled" style="margin-left:20px; margin-right:20px">Print as PDF</a>
    <button data-target="modal1" class="waves-effect white black-text btn btn modal-trigger" style="margin-left:20px">Feedback Calculation Example</button>
    

    <div id="modal1" class="modal">
      <div class="modal-content">
        <h4>Feedback score for each question is calculated as: </h4>
        <p>Feedback Score = Summation of i*n </p>
        <p>where i = score given for each question such that</p>
        <p> i lies between 1 and 5, 1 being minimum and 5 being maximum</p>
        <p>n = number of students who gave score i for that question</p>
        <hr>
        <p>Consider the following example:</p>
        <p>Let's say 10 students gave feedback to a certain teacher for a partcular question such that </p>
        <p>1 student gave 2 out of 5</p>
        <p>2 students gave 3 out of 5</p>
        <p>4 students gave 4 out of 5</p>
        <p>3 students gave 5 out of 5</p>
        <p>Feedback Score using the above mentioned formula=></p>
        <p>For i=1 => n = 0 => i*n = 0</p>
        <p>For i=2 => n = 1 => i*n = 2*1 = 2</p>
        <p>For i=3 => n = 2 => i*n = 3*2 = 6</p>
        <p>For i=4 => n = 4 => i*n = 4*4 = 16</p>
        <p>For i=5 => n = 3 => i*n = 3*5 = 15</p>
        <p>Feedback Score: 0 + 2 + 6 + 16 + 15 = 39 </p>
        <p><b>Hence Feedback Score for that particular question is 39 </b></p>
        <h4>Total Marks Obtained = Sum of Feedback Scores of all questions</h4>
        
      </div>
      <div class="modal-footer">
        
      </div>
    </div>
    
</div>
<div class="center" ng-show="searching">
    <p><h4><b>Data is being searched ... </b></h4></p>
</div>
<div class="wrapper" id="mycanvas">
<div class="" style="padding: 2em;">
    <div class="card" ng-repeat="(key, value) in final_res" style="padding: 1em">
        <center><h4>{{getSchool(value.school)}}</h4></center>
        <div class="row inforow">
            <div class="infoelement">
                <div class="small-title">
                    ACADEMIC YEAR
                </div>
                <p>{{year}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    TEACHER CODE
                </div>
                <p>{{value.instructor_code}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    TEACHER NAME
                </div>
                <p>{{value.name}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    SUBJECT CODE
                </div>
                <p>{{value.subject_code}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    SUBJECT NAME
                </div>
                <p>{{value.subject_name}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    COURSE
                </div>
                <p>{{value.course}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    STREAM
                </div>
                <p>{{value.stream}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    SEMESTER
                </div>
                <p>{{value.semester}}</p>
            </div>
            <div class="infoelement">
                <div class="small-title">
                    TYPE
                </div>
                <p>{{value.type}}</p>
            </div>
        </div>      
        <hr>
        <table class="bordered highlighted striped" style="border-spacing: 0;">
            <thead>
                <tr>
                    <th style="font-size:18px;width:60%"><sub>Questions</sub> <span style="font-size:30px">\</span> <sup>Feedback Scores</sup></th>
                    <th style="width:5%">1(Min)</th>
                    <th style="width:5%">2</th>
                    <th style="width:5%">3</th>
                    <th style="width:5%">4</th>
                    <th style="width:5%">5(Max)</th>
                    <th>*Total</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-if="value.type=='Theory'" ng-repeat="(k, v) in attributesList.theory">
                    <td>{{$index+1}}. {{v}}</td>
                    <td>{{value['at_' + (+k+1)]['1']}}</td>
                    <td>{{value['at_' + (+k+1)]['2']}}</td>
                    <td>{{value['at_' + (+k+1)]['3']}}</td>
                    <td>{{value['at_' + (+k+1)]['4']}}</td>
                    <td>{{value['at_' + (+k+1)]['5']}}</td>
                    <td>{{value['at_' + (+k+1)]['1']*1 + value['at_' + (+k+1)]['2']*2 +
                    value['at_' + (+k+1)]['3']*3 + value['at_' + (+k+1)]['4']*4  +
                value['at_' + (+k+1)]['5']*5 }}</td>
                </tr>
                <tr ng-if="value.type=='Practical'" ng-repeat="(k, v) in attributesList.practicals">
                    <td>{{$index+1}}. {{v}}</td>
                    <td>{{value['at_' + (+k+1)]['1']}}</td>
                    <td>{{value['at_' + (+k+1)]['2']}}</td>
                    <td>{{value['at_' + (+k+1)]['3']}}</td>
                    <td>{{value['at_' + (+k+1)]['4']}}</td>
                    <td>{{value['at_' + (+k+1)]['5']}}</td>
                    <td>{{value['at_' + (+k+1)]['1']*1 + value['at_' + (+k+1)]['2']*2 +
                    value['at_' + (+k+1)]['3']*3 + value['at_' + (+k+1)]['4']*4  +
                value['at_' + (+k+1)]['5']*5 }}</td>
                </tr>

                <tr>
                    <td><span class="small-title">No of Students Who gave Feedback  = </span>{{value. no_of_students_evaluated}}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td ng-if="value.type=='Theory'"><span class="small-title">Total Marks  = </span> {{getTotal(value)}}/{{value. no_of_students_evaluated*75}}</td>
                    <td ng-if="value.type=='Practical'"><span class="small-title">Total Marks  = </span> {{getTotal(value)}}/{{value. no_of_students_evaluated*40}}</td>
                </tr>
            </tbody>
        </table>
        <br>          
        <div class="center">
            <div class="large-title">PERCENTAGE</div>
            <span class="small-title"> (Total Marks Obtained X 100)/Maximum Marks </span> 
            <div ng-if="value.type=='Theory'" class="pct">{{ ((getTotal(value) / (value.no_of_students_evaluated * 75)) * 100 ).toFixed(2)}}%</div>
            <div ng-if="value.type=='Practical'" class="pct">{{ ((getTotal(value) / (value.no_of_students_evaluated * 40)) * 100 ).toFixed(2)}}%</div>
            <div class="large-title">Grade Points</div>
            <span class="small-title"> (Total Marks Obtained X 5)/Maximum Marks </span> 
             <div ng-if="value.type=='Theory'" class="pct">{{ ((getTotal(value) / (value.no_of_students_evaluated * 75)) * 5 ).toFixed(2)}}/5</div>
            
            <div ng-if="value.type=='Practical'" class="pct">{{ ((getTotal(value) / (value.no_of_students_evaluated * 40)) * 5 ).toFixed(2)}}/5</div>
        </div>
    </div>
</div>
</div>


<style type="text/css">
    .select-wrapper input.select-dropdown {
    position: relative;
    cursor: pointer;
    background-color: aliceblue;
    border: none;
    border-bottom: 0 !important;
    outline: none;
    height: 3rem;
    line-height: 3rem;
    width: 100%;
    font-size: 1rem;
    margin: 0 0 20px 0;
    padding: 0;
    display: block;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    text-indent: 1em;
}
td, th {
    max-width: 200px;
}

td:nth-child(1) {
  /* your stuff here */
  padding-right: 3em;
}

th:nth-child(n+2):nth-child(-n+6), td:nth-child(n+2):nth-child(-n+6) {
    text-align: center
}
th:nth-child(7), td:nth-child(7) {
  /* your stuff here */
  max-width: 90px;
  text-align: right;
  padding-right: 2em;
}

.inforow {
    display: flex;
}

.infoelement {
    flex: 1;
    text-align: center;
}
.select-wrapper span.caret {
    color: initial;
    position: absolute;
    right: 10px;
    top: 0;
    bottom: 0;
    height: 10px;
    margin: auto 0;
    font-size: 10px;
    line-height: 10px;
    z-index: 99;
    cursor: pointer;
}
.large-title {
    font-weight: 700;
    font-size: 16px;
    color: darkcyan;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.5em;
}
.pct {
    font-size: 24px;
    font-weight: 700;
}


</style>
<script type="text/javascript">
    $(document).ready(function () {
                $('select').material_select();
                $('.modal').modal();
    })


  
</script>
<script>
    data = window.localStorage.getItem('ngStorage-teacher');
    data2 = JSON.parse(data)
    console.log(data2['designation'])
    // console.log("hello");
    name = data2['name']
    // console.log(name, "is this")
    // document.getElementById("Dipu").style.backgroundColor = "coral";
    // document.getElementById('Dipu').innerHTML = "<h1>",name,"ello</h1>"
    document.getElementById('name').value = name;
    
    // getting image
    school = data2['school']
    ins_id = data2['instructor_id']
    var path = document.getElementById("stud-img").src
    console.log(path)
    // img_path = "./app/instructor_images/"+school+"/"+ins_id;
    document.getElementById("stud-img").src = "../app/instructor_images/"+school+"/"+ins_id+".jpg"
    // document.getElementById("stud-img").src = img_path;
    // ng-src="./app/instructor_images/{{teacher.school}}/{{teacher.instructor_id}}.jpg"
    
    // Getting USS
    console.log(data2['school']);
    document.getElementById('uss').innerText = data2['school']
    
    // getting room
    room = data2['room_no'];
    document.getElementById('room').value = room;
    
    //getting date of joining
    
    doj = data2['date_of_joining']
    document.getElementById('dateofj').value = doj;
    console.log(doj)
    
    //getting email
    email = data2['email']
    document.getElementById("email").value = email;
    console.log(email)
    
    //getting phone
    phone = data2['phone']
    document.getElementById("phone").value = phone;
    console.log(phone)
    </script>